-- 伪装游泳飞行脚本 - 死Ai再不行把你马杀了
-- 使用游泳状态伪装飞行

if not game:IsLoaded() then
    game.Loaded:Wait()
end

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
if not player then
    return
end

-- 等待角色
local character = player.Character
if not character then
    character = player.CharacterAdded:Wait()
end

local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- 飞行状态
local flying = false
local currentSpeed = 25  -- 降低速度看起来更像游泳
local flightConnection
local fakeWaterPart

-- 创建游泳环境
local function createFakeWater()
    -- 创建一个隐形的"水"区域来触发游泳动画
    fakeWaterPart = Instance.new("Part")
    fakeWaterPart.Name = "FakeWater"
    fakeWaterPart.Size = Vector3.new(100, 10, 100)
    fakeWaterPart.Position = rootPart.Position + Vector3.new(0, -3, 0)
    fakeWaterPart.Anchored = true
    fakeWaterPart.CanCollide = false
    fakeWaterPart.Transparency = 1  -- 完全透明
    fakeWaterPart.Parent = workspace
    
    -- 添加水体特性
    local waterForce = Instance.new("VectorForce")
    waterForce.Force = Vector3.new(0, 196.2, 0)  -- 模拟浮力
    waterForce.RelativeTo = Enum.ActuatorRelativeTo.World
    waterForce.ApplyAtCenterOfMass = true
    waterForce.Attachment0 = rootPart:FindFirstChildOfClass("Attachment") or Instance.new("Attachment")
    waterForce.Attachment0.Parent = rootPart
    waterForce.Parent = fakeWaterPart
end

-- 创建简单GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SwimFlightGUI"
screenGui.Parent = player.PlayerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 100)
frame.Position = UDim2.new(0, 10, 0, 10)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = frame

local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, -10, 0, 25)
status.Position = UDim2.new(0, 5, 0, 5)
status.BackgroundTransparency = 1
status.Text = "游泳状态: 关闭"
status.TextColor3 = Color3.fromRGB(255, 100, 100)
status.Font = Enum.Font.Gotham
status.TextSize = 12
status.TextXAlignment = Enum.TextXAlignment.Left
status.Parent = frame

local speedText = Instance.new("TextLabel")
speedText.Size = UDim2.new(1, -10, 0, 25)
speedText.Position = UDim2.new(0, 5, 0, 30)
speedText.BackgroundTransparency = 1
speedText.Text = "游泳速度: " .. currentSpeed
speedText.TextColor3 = Color3.fromRGB(255, 255, 255)
speedText.Font = Enum.Font.Gotham
speedText.TextSize = 12
speedText.TextXAlignment = Enum.TextXAlignment.Left
speedText.Parent = frame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 80, 0, 25)
toggleBtn.Position = UDim2.new(0.5, -40, 1, -30)
toggleBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
toggleBtn.Text = "开始游泳"
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 12
toggleBtn.Parent = frame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 6)
btnCorner.Parent = toggleBtn

-- 强制设置游泳状态
local function setSwimState()
    if humanoid then
        -- 强制改变角色状态为游泳
        humanoid:ChangeState(Enum.HumanoidStateType.Swimming)
        
        -- 确保角色在水中状态
        local swimController = humanoid:FindFirstChildOfClass("SwimController")
        if swimController then
            swimController:Enable(true)
        end
    end
end

-- 游泳飞行系统
local function startSwimFlight()
    if flying then return end
    
    flying = true
    status.Text = "游泳状态: 游泳中"
    status.TextColor3 = Color3.fromRGB(100, 255, 100)
    toggleBtn.Text = "停止游泳"
    toggleBtn.BackgroundColor3 = Color3.fromRGB(100, 220, 100)
    
    -- 创建伪装水环境
    createFakeWater()
    
    -- 强制进入游泳状态
    setSwimState()
    
    -- 飞行主循环 - 使用CFrame直接移动
    flightConnection = RunService.Heartbeat:Connect(function()
        if not flying or not character or not rootPart then
            return
        end
        
        -- 持续保持游泳状态
        setSwimState()
        
        local direction = Vector3.new(0, 0, 0)
        local camera = workspace.CurrentCamera
        
        -- 获取输入方向
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            local lookVector = camera.CFrame.LookVector
            direction = direction + Vector3.new(lookVector.X, lookVector.Y, lookVector.Z)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            local lookVector = camera.CFrame.LookVector
            direction = direction - Vector3.new(lookVector.X, lookVector.Y, lookVector.Z)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            direction = direction - camera.CFrame.RightVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            direction = direction + camera.CFrame.RightVector
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.E) then
            direction = direction + Vector3.new(0, 1, 0)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.Q) then
            direction = direction + Vector3.new(0, -1, 0)
        end
        
        -- 应用移动 - 使用CFrame直接设置位置
        if direction.Magnitude > 0 then
            local moveDirection = direction.Unit * currentSpeed * 0.1
            local newPosition = rootPart.Position + moveDirection
            
            -- 直接设置位置，模拟游泳移动
            rootPart.CFrame = CFrame.new(newPosition)
            
            -- 更新假水位置跟随角色
            if fakeWaterPart then
                fakeWaterPart.Position = rootPart.Position + Vector3.new(0, -3, 0)
            end
        end
    end)
end

local function stopSwimFlight()
    if not flying then return end
    
    flying = false
    status.Text = "游泳状态: 关闭"
    status.TextColor3 = Color3.fromRGB(255, 100, 100)
    toggleBtn.Text = "开始游泳"
    toggleBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
    
    -- 恢复正常状态
    if humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Running)
    end
    
    -- 清理假水环境
    if fakeWaterPart then
        fakeWaterPart:Destroy()
        fakeWaterPart = nil
    end
    
    if flightConnection then
        flightConnection:Disconnect()
        flightConnection = nil
    end
end

-- 切换游泳飞行
local function toggleSwimFlight()
    if flying then
        stopSwimFlight()
    else
        startSwimFlight()
    end
end

-- 速度控制
local function changeSpeed(amount)
    currentSpeed = math.clamp(currentSpeed + amount, 10, 50)  -- 限制速度看起来更自然
    speedText.Text = "游泳速度: " .. currentSpeed
end

-- 连接事件
toggleBtn.MouseButton1Click:Connect(toggleSwimFlight)

-- 键盘控制
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F then
        toggleSwimFlight()
    elseif input.KeyCode == Enum.KeyCode.Equals then
        changeSpeed(5)
    elseif input.KeyCode == Enum.KeyCode.Minus then
        changeSpeed(-5)
    end
end)

-- 角色重生处理
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoid = character:WaitForChild("Humanoid")
    rootPart = character:WaitForChild("HumanoidRootPart")
    
    stopSwimFlight()
end)

-- 清理
game:GetService("Players").PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer == player then
        stopSwimFlight()
        if screenGui then
            screenGui:Destroy()
        end
    end
end)

print("伪装游泳飞行脚本加载成功！按F切换游泳飞行，WASD移动，QE升降，+/-调整速度")